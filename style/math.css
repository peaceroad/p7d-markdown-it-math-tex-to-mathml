@font-face {
  font-family: math;
  src: local('STIX Two Math'),
  /*url('https://example.com/assets/fonts/math/STIXTwoMath-Regular.woff2') format('woff2');*/
}
math {
  font-family: math;
  letter-spacing: 0.075em;
  @supports (-moz-appearance: none) {
    letter-spacing: initial;
  }
}
math:not([display="block"]) {
  margin: 0 0.15em;
}
math[display="block"] {
  margin: 2em auto;
  /* Centering Multiple Expressions */
  mtable > :is(mtr, mlabeledtr) > mtd {
    padding-block: 0.5em;
  }
  mtable[columnalign="right left"] > mtr > mtd {
    &:nth-child(1) {
      text-align: -webkit-right; /* for chrome */
    }
    &:not(:nth-child(1)) {
      text-align: -webkit-left; /* for chrome */
    }
  }
  /* formula number by \tag{} */
  &:has(> mtable:not([columnalign="right left"]) > mlabeledtr > mtd[id^="mjx-eqn"]) {
    margin-inline: 0;
    > mtable {
      inline-size: 100%;
      > mlabeledtr {
        inline-size: 100%;
        display: grid;
        grid-template-columns: 1fr;
        align-items: center;
        > mtd {
          display: math;
          &[id^="mjx-eqn"] {
            @supports (-moz-appearance: none) {
              display: block;
            }
            grid-column: 1 / -1;
            grid-row: 1 / 2;
            justify-self: end;
            padding-inline-end: 0.2em;
          }
          &:not([id^="mjx-eqn"]) {
            grid-column: 1 / -1;
            grid-row: 1 / 2;
            justify-self: center;
          }
        }
      }
    }
  }
}

math:has(> mtable[columnalign="right left"] > mlabeledtr > mtd[id^="mjx-eqn:"]) {
  margin-inline: 0;
  > mtable {
    display: grid;
    inline-size: 100%;
    grid-template-columns: 1fr auto auto 1fr;
    > mtr, mlabeledtr {
      display: grid;
      grid-template-columns: subgrid;
      grid-column: 1 / -1;
      align-items: center;
      position: relative;
      > mtd {
        display: math;
      }
    }
    > mtr > mtd {
      &:nth-child(1) {
        grid-column: 2;
        justify-self: end;
        text-align: end;
      }
      &:nth-child(2) {
        grid-column: 3;
        justify-self: start;
        /*padding-left: 0.1em;*/
        text-align: start;
      }
    }
    > mlabeledtr > mtd {
      &:nth-child(1) {
        @supports (-moz-appearance: none) {
          display: block;
        }
        position: absolute;
        right: 0;
        top: 50%;
        transform: translateY(-50%);
        white-space: nowrap;
        z-index: 10;
      }
      &:nth-child(2) {
        grid-column: 2;
        justify-self: end;
      }

      &:nth-child(3) {
        grid-column: 3;
        justify-self: start;
        text-align: start;
      }
    }
  }
}